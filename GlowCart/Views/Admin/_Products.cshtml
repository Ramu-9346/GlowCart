@model IEnumerable<GlowCart.Entities.Models.Product>
<link rel="stylesheet" href="~/css/admin-products.css" />

<div class="container mt-4 admin-products">
    <h4 class="fw-bold text-primary mb-3">🛍️ Product Management</h4>

    <!-- 🔍 Filter Bar -->
    <div class="filter-bar mb-2">
        <input type="text" id="txtSearch" placeholder="🔍 Search products..." />
        <button class="btn-filter active" data-filter="all">All</button>
        <button class="btn-filter" data-filter="instock">In Stock</button>
        <button class="btn-filter" data-filter="outstock">Out of Stock</button>
        <button id="btnRefresh" class="btn-refresh"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
        <button id="btnAddProduct" class="btn-add"><i class="bi bi-plus-lg"></i> Add New Product</button>
    </div>

    <!-- 🧾 Product Table -->
    <div class="table-container">
        <table class="data-grid">
            <thead>
                <tr>
                    <th>Product ID</th>
                    <th>Product Name</th>
                    <th>Brand</th>
                    <th>Price (₹)</th>
                    <th>Status</th>
                    <th style="text-align:center;">Actions</th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                @foreach (var item in Model)
                {
                    <tr data-id="@item.ProductId" class="@(item.IsAvailable ? "" : "outstock")">
                        <td>@item.ProductId</td>
                        <td>@item.ProductName</td>
                        <td>@item.Brand</td>
                        <td>@item.Price</td>
                        <td>
                            <span class="status-dot @(item.IsAvailable ? "instock" : "outstock")">
                                <span class="dot"></span>
                                @(item.IsAvailable ? "In Stock" : "Out of Stock")
                            </span>
                        </td>
                        <td style="text-align:center;">
                            <button class="action-btn edit" title="Edit"><i class="bi bi-pencil-fill"></i></button>
                            <button class="action-btn delete" title="Delete"><i class="bi bi-trash-fill"></i></button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- ✅ SCRIPTS -->
<script>
    $(document).ready(function () {

        // 🔍 Search Filter
        $("#txtSearch").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#productTableBody tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });

        // 🟢 Filter by stock
        $(".btn-filter").click(function () {
            $(".btn-filter").removeClass("active");
            $(this).addClass("active");
            var filter = $(this).data("filter");

            $("#productTableBody tr").show();
            if (filter === "instock") $("#productTableBody tr.outstock").hide();
            else if (filter === "outstock") $("#productTableBody tr:not(.outstock)").hide();
        });

        // 🔁 Refresh
        $("#btnRefresh").click(function () {
            $("#txtSearch").val('');
            $(".btn-filter[data-filter='all']").click();
        });

        // ➕ Add Product
        $("#btnAddProduct").click(function () {
            openProductModal("add");
        });

        // ✏️ Edit Product
        $(document).on("click", ".action-btn.edit", function () {
            var id = $(this).closest("tr").data("id");
            $.get("/Admin/GetProduct", { id: id }, function (res) {
                if (res.success && res.product) openProductModal("edit", res.product);
                else alert("Failed to load product!");
            });
        });

        // 🗑️ Delete Product
        $(document).on("click", ".action-btn.delete", function () {
            var id = $(this).closest("tr").data("id");
            if (confirm("Are you sure you want to delete this product?")) {
                $.post("/Admin/DeleteProduct", { id: id }, function (res) {
                    alert(res.message);
                    if (res.success) location.reload();
                });
            }
        });
    });
</script>
